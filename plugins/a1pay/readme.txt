Плагин "A1Pay" 
Автор: Dminty (http://d51x.ru)
---------------------------------------------------------------------------------------------------

A1Pay - это агрегатор платежей. Он предоставляет возможность продавать товар на сайте с использованием различных систем оплаты.
Подробнее здесь http://a1pay.ru
---------------------------------------------------------------------------------------------------

Данный плагин позволяет организовать на сайте продажу различных электронных товаров, а именно, файлов, с оплатой через агрегатора.
При этом оплату можно производить через различные платежные системы, поддержку которых предоставляет агрегатор. Например, Яндекс.Деньги, QIWI, SMS, терминалы оплаты и другие.
Важной частью плагина является то, что после оплаты товара покупатель получает уникальную сгенерированную ссылку на скачивание.
В настройках плагина можно задавать время жизни ссылки, например, через 1 месяц полученная ссылка будет недействительна.
Так же можно ограничивать скачивание по IP.
Плагин ведет внутреннюю статистику по оплаченным товарам. Эти данные включают в себя служебные данные (id транзакции агрегатора, id сервиса), данные об оплате товара (№ заказа, способ оплаты, стоимость, дата и время оплаты), данные покупателя (IP, e-mail, телефон, если был указан).
Для товара можно выбрать один из двух типов цены - фиксированная или свободная. В случае второго варианта задается минимальная цена и рекомендованная.
----------------------------------------------------------------------------------------------------

Настройка плагина.
Плагин имеет общие настройки.
 * "Секретный ключ" - ключ, по которому проверяется достоверность передаваемых данных. Этот ключ указывается при создании сервиса в A1Pay.
 * "Время жизни ссылок" - Время жизни ссылок по умолчанию. Указывается в секундах. Рекомендуется задать время жизни как 1 месяц, т.е. 2592000 секунд
 * "Папка хранения файлов" - папка хранения файлов относительно корневой папки сайта. Рекомендуется создать папку вне папки сайта, желательно, на том же уровне, чтобы доступа к этой папки из интернета не было.
 * "Тестовый режим" - позволяет провести тестирование сервиса на сайте a1pay.
 * "Время жизни ссылок" - отметьте эту опцию, если необходимо, чтобы ссылка действовала ограниченное время. Рекомендуется включить эту опцию.
 * "Проверка по IP" - отметьте, если желаете вести более точный контроль скачивания
 * "Описание для блока с фиксированной ценой" - в это поле можно ввести текст, который будет отображаться перед формой оплаты для товара с фиксированной ценой
 * "Описание для блока со свободной ценой" - в это поле можно ввести текст, который будет отображаться перед формой оплаты для товара со свободной ценой. По умолчанию текст уже задан.
 * "Изображение для кнопки" - можно изменить стандартную кнопку оплаты. Для этого надо подготовить картинку, положить ее в папку шаблона и в это поле ввести адрес адрес картиинки относительно папки шаблона.
---------------------------------------------------------------------------------------------------- 
 
Использование:
1. Формируем сервис на сайте a1pay
2. Формируем форму оплаты
3. Заносим в плагине в базу информацию о созданном сервисе 
4. Вставляем на страницу код для формирования кнопки оплаты

----------------------------------------------------------------------------------------------------
Как создать сервис в a1pay?
1. на сайте a1pay.ru переходим в "Инструменты"
2. Добавляем новый сервис.
3. Вводим название сервиса, например, "Товар 01"
4. В поле "URL скрипта обработчика на Вашем сайте" вводим адрес http://<ваш сайт>.ru/a1process
5. В поле "URL страницы успешной покупки" вводим адрес http://<ваш сайт>.ru/a1success
6. В поле "URL страницы ошибки" вводим адрес http://<ваш сайт>.ru/a1fail
7. Вводим секретный ключ
8. Вводим ваш e-mail, но необязательно. СМ. описание на сайте.
9. Отмечаем, какие данные должны быть обязательно указаны (номер телефона, email) при совершении платежа.
10. Отмечаем необходимые способы оплаты.
11. Сохраняем.

В итоге видим запись в таблице со следующими данными - id, название и кнопки действий.
id - это id сервиса, который надо использовать при внесении данных в базу плагина

----------------------------------------------------------------------------------------------------
Теперь надо сформировать форму оплаты. Но на самом деле нам это форма не нужна, а нужен лишь уникальный ключ этой формы.
1. Нажимаем "Создать кнопку" (зеленая корзина). 
2. Нажимаем на ссылку "Передавать в скрипт через переменные"
3. Нажимаем "Создать код кнопки"
4. в коде полученной формы найдите строку, похожую на 
	<input type="hidden" name="key" value="3Nu/mDsZfdkCIr9HrH6nH8KiwJhhwVQCl3diR7HRvxw=" />
	отсюда нам надо "3Nu/mDsZfdkCIr9HrH6nH8KiwJhhwVQCl3diR7HRvxw=" без кавычек
	это и будет уникальный ключ формы

----------------------------------------------------------------------------------------------------	
Теперь занесем данные о сервисе в базу плагина
1. в плагине выбираем "управление сервисами"
2. вводим id сервиса в поле "service id". Это значени берется из таблицы сервисов в a1pay 
3. В поле "service key" вводим уникальный ключ формы
4. Вводим название
5. Вводим имя файла
6. Вводим подкаталог, если надо
7. Вводим цену
8. Если товар продается по свободной цене, то вводим минимальную цену
9. Нажимаем "Добавить в базу"

Ниже в таблице отобразиться новый сервис. Нажмите на имя файла (ссылка) и вы получите код для вставки на страницу (например, [a1pay id=12]). Скопируйте этот код в буфер обмена и вставьте в нужное место на странице. 
 
 	