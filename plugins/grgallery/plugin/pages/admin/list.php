<?php if (!defined('BASEPATH')) exit('No direct script access allowed'); require_once( getinfo('common_dir') . 'category.php' ); require_once( getinfo('common_dir') . 'page.php' ); $slug = mso_segment('4');$id_cat = mso_get_cat_from_slug($slug, $full = false);$categories = array ($id_cat);$par = array( 'type' => false, 'custom_type'=>'home', 'limit' => 20);if ($id_cat != false) $par = array( 'type' => false, 'custom_type'=>'category', 'limit' => 20, 'categories' => $categories); $pages = mso_get_pages($par, $pagination); // получим все - второй параметр нужен для сформированной пагинации$pagination;$nmcat = t('страниц по рубрикам', 'plugins/grgallery');$out05 ='<h1 class="content">'.t('Списки ', 'plugins/grgallery').' '.$nmcat.'</h1>	<table style="width: 99%; border: none; line-height: 1.4em;">		<tr>			<td style="vertical-align: top; padding: 0 10px 0 0;">';									//--подготавливаем данные для таблицы для вывода$tbl[1][1]='id'; $tbl[1][2]=t('редактировать', 'plugins/grgallery'); $tbl[1][3]=t('удалить', 'plugins/grgallery');$arr_id_page = array();$i=1;			foreach ($pages as $page) // выводим в цикле	{		$i++;		extract($page);		$tbl[$i][1] = $page_id;		$tbl[$i][2]= mso_page_title($page_id, $page_title, '', '<br>', true, false, 'admin/page_edit');					$tbl[$i][3] = '<input name="postdell[]" type="checkbox" value="'.$page_id.'">';		$arr_id_page[] = $page_id;	}	$all_id_page = serialize($arr_id_page); // для удаления всех страниц рубрики передаем их id в хиббен	$out05 .= form_open($plugin_url .'/pages').mso_form_session('f_session_id').	form_hidden('all_page_id', $all_id_page).	form_hidden('slug', $slug).	form_submit('toadd', t('новая страница', 'plugins/grgallery') ).	form_submit('delall', t('удалить всё', 'plugins/grgallery') ).	form_submit('del', t('удалить отмеченные', 'plugins/grgallery') ).		buildtable($tbl).form_close();    // ф-ция отрисовки таблицы из библиотеки	if ( !isset($options['include']) ) $options['include'] = array();	if ( !isset($options['exclude']) ) $options['exclude'] = array();	if ( !isset($options['format']) ) $options['format'] = '[LINK][TITLE]<sup>[COUNT]</sup>[/LINK]';	if ( !isset($options['format_current']) ) $options['format_current'] = '<span>[TITLE]<sup>[COUNT]</sup></span><br><em>[DESCR]</em>';	if ( !isset($options['header']) ) $options['header'] = '';	if ( !isset($options['hide_empty']) ) $options['hide_empty'] = 0;	if ( !isset($options['order']) ) $options['order'] = 'category_name';	if ( !isset($options['order_asc']) ) $options['order_asc'] = 'ASC';	if ( !isset($options['include_child']) ) $options['include_child'] = 0;	if ( !isset($options['nofollow']) ) $options['nofollow'] = false;			$all = mso_cat_array('page', 0, $options['order'], $options['order_asc'], $options['order'], $options['order_asc'], $options['include'], $options['exclude'], $options['include_child'], $options['hide_empty'], true);		$allpages = '<a href="'.$plugin_url .'/pages">'.t('все страницы','admin').'</a><hr class = "br"/>';		$out = mso_create_list($all, array('childs'=>'childs', 'format'=>$options['format'], 'format_current'=>$options['format_current'], 'class_ul'=>'is_link', 'title'=>'category_name', 'link'=>'category_slug', 'current_id'=>false, 'prefix'=>'admin/grgallery/pages/', 'count'=>'pages_count', 'slug'=>'category_slug', 'id'=>'category_id', 'menu_order'=>'category_menu_order', 'id_parent'=>'category_id_parent', 'nofollow'=>$options['nofollow'] ) );		if ($out and $options['header']) $out = $options['header'] . $out;		$out1 = '</td><td style="vertical-align: top; width: 250px;">';	$out2 = '</td></tr></table>';	$out = $out05.$out1.$allpages.$out.$out2;?>